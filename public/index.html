<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatto - Real-time Chat</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: #f5f5f5;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Material Design Elevation */
        .elevation-1 { box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); }
        .elevation-2 { box-shadow: 0 3px 6px rgba(0,0,0,0.15), 0 2px 4px rgba(0,0,0,0.12); }
        .elevation-3 { box-shadow: 0 10px 20px rgba(0,0,0,0.15), 0 3px 6px rgba(0,0,0,0.10); }
        .elevation-4 { box-shadow: 0 15px 25px rgba(0,0,0,0.15), 0 5px 10px rgba(0,0,0,0.05); }

        /* Auth Screen */
        #auth-screen {
            background: #ffffff;
            padding: 48px 40px;
            border-radius: 8px;
            text-align: center;
            width: 400px;
        }

        #auth-screen h1 {
            color: #1976d2;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 28px;
        }

        #auth-screen p {
            color: #666;
            margin-bottom: 32px;
            font-size: 14px;
        }

        .auth-form input {
            padding: 16px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #fff;
            color: #333;
            width: 100%;
            margin-bottom: 16px;
            transition: border-color 0.2s, box-shadow 0.2s;
            font-family: 'Roboto', sans-serif;
        }

        .auth-form input:focus {
            outline: none;
            border-color: #1976d2;
            box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2);
        }

        .auth-form button {
            padding: 14px 24px;
            font-size: 14px;
            font-weight: 500;
            background: #1976d2;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s, box-shadow 0.2s;
            width: 100%;
            margin-top: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: 'Roboto', sans-serif;
        }

        .auth-form button:hover {
            background: #1565c0;
            box-shadow: 0 2px 8px rgba(25, 118, 210, 0.4);
        }

        .auth-toggle {
            color: #666;
            margin-top: 24px;
            font-size: 14px;
        }

        .auth-toggle a {
            color: #1976d2;
            cursor: pointer;
            text-decoration: none;
            font-weight: 500;
        }

        .auth-toggle a:hover {
            text-decoration: underline;
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 12px 16px;
            border-radius: 4px;
            margin-bottom: 16px;
            font-size: 14px;
            display: none;
            text-align: left;
            border-left: 4px solid #c62828;
        }

        .success-message {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 12px 16px;
            border-radius: 4px;
            margin-bottom: 16px;
            font-size: 14px;
            display: none;
            text-align: left;
            border-left: 4px solid #2e7d32;
        }

        /* Chat Screen */
        #chat-screen {
            display: none;
            width: 100%;
            height: 100vh;
            background: #f5f5f5;
        }

        #chat-layout {
            display: flex;
            height: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 16px;
            gap: 16px;
        }

        /* Rooms Sidebar */
        #rooms-sidebar {
            width: 280px;
            background: #fff;
            border-radius: 8px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 20px 16px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-header h3 {
            color: #333;
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        #rooms-list {
            list-style: none;
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
        }

        #rooms-list li {
            color: #333;
            padding: 12px 16px;
            cursor: pointer;
            margin: 0 8px;
            border-radius: 4px;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        #rooms-list li:hover {
            background: #f5f5f5;
        }

        #rooms-list li.active {
            background: #e3f2fd;
            color: #1976d2;
        }

        #rooms-list li .room-icon {
            color: #757575;
            font-size: 20px;
        }

        #rooms-list li.active .room-icon {
            color: #1976d2;
        }

        #rooms-list li .room-info {
            flex: 1;
            min-width: 0;
        }

        #rooms-list li .room-name {
            font-weight: 500;
            font-size: 14px;
        }

        #rooms-list li .room-desc {
            font-size: 12px;
            color: #757575;
            margin-top: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #rooms-list li.active .room-desc {
            color: #1976d2;
            opacity: 0.8;
        }

        #create-room-btn {
            margin: 8px 16px 16px;
            padding: 10px 16px;
            background: #fff;
            border: 1px solid #1976d2;
            color: #1976d2;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: 'Roboto', sans-serif;
        }

        #create-room-btn:hover {
            background: #e3f2fd;
        }

        /* Users Sidebar */
        #users-sidebar {
            width: 240px;
            background: #fff;
            border-radius: 8px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        #users-sidebar .sidebar-header {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #users-sidebar .sidebar-header .online-dot {
            width: 8px;
            height: 8px;
            background: #4caf50;
            border-radius: 50%;
        }

        #online-users {
            list-style: none;
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
        }

        #online-users li {
            color: #333;
            padding: 10px 16px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        #online-users li:hover {
            background: #f5f5f5;
        }

        #online-users li .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            position: relative;
        }

        #online-users li .avatar .status-dot {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 2px solid #fff;
        }

        .status-online { background: #4caf50; }
        .status-away { background: #ff9800; }
        .status-busy { background: #f44336; }
        .status-offline { background: #9e9e9e; }

        /* Profile Card in Sidebar */
        #profile-card {
            padding: 16px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        #profile-card:hover {
            background: #f5f5f5;
        }

        #profile-card .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            font-weight: 500;
            text-transform: uppercase;
        }

        #profile-card .profile-info {
            flex: 1;
            min-width: 0;
        }

        #profile-card .profile-name {
            font-weight: 500;
            font-size: 14px;
            color: #333;
        }

        #profile-card .profile-status {
            font-size: 12px;
            color: #757575;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        #profile-card .profile-status .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        #profile-card .settings-icon {
            color: #757575;
            font-size: 20px;
        }

        #logout-btn {
            margin: 8px 16px 16px;
            padding: 10px 16px;
            background: #fff;
            border: 1px solid #e0e0e0;
            color: #666;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: 'Roboto', sans-serif;
        }

        #logout-btn:hover {
            background: #ffebee;
            border-color: #ef5350;
            color: #c62828;
        }

        /* Main Chat Area */
        #chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
        }

        #chat-header {
            padding: 16px 24px;
            background: #1976d2;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #chat-header .room-info h2 {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 2px;
        }

        #chat-header .room-info span {
            font-size: 13px;
            opacity: 0.9;
        }

        #chat-header .user-info {
            font-size: 13px;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #chat-header .user-info .material-icons {
            font-size: 18px;
        }

        #messages {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            list-style: none;
            background: #fafafa;
        }

        .message {
            margin-bottom: 16px;
            display: flex;
            gap: 12px;
        }

        .message .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            flex-shrink: 0;
        }

        .message .message-content {
            flex: 1;
            min-width: 0;
        }

        .message-header {
            display: flex;
            align-items: baseline;
            gap: 8px;
            margin-bottom: 4px;
        }

        .message-username {
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }

        .message-time {
            color: #9e9e9e;
            font-size: 12px;
        }

        .message-text {
            color: #333;
            background: #fff;
            padding: 12px 16px;
            border-radius: 4px;
            border-radius: 0 12px 12px 12px;
            display: inline-block;
            max-width: 100%;
            word-wrap: break-word;
            font-size: 14px;
            line-height: 1.5;
        }

        .message.own {
            flex-direction: row-reverse;
        }

        .message.own .message-header {
            justify-content: flex-end;
        }

        .message.own .message-content {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .message.own .message-text {
            background: #1976d2;
            color: white;
            border-radius: 12px 0 12px 12px;
        }

        .system-message {
            text-align: center;
            color: #9e9e9e;
            font-size: 13px;
            padding: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .system-message::before,
        .system-message::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #e0e0e0;
            max-width: 100px;
        }

        #no-room-selected {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #9e9e9e;
            font-size: 16px;
            background: #fafafa;
        }

        #no-room-selected .material-icons {
            font-size: 64px;
            margin-bottom: 16px;
            color: #e0e0e0;
        }

        /* Message Form */
        #form {
            display: none;
            padding: 16px 24px;
            background: #fff;
            border-top: 1px solid #e0e0e0;
            gap: 12px;
        }

        #input {
            flex: 1;
            padding: 14px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 24px;
            font-size: 14px;
            background: #fafafa;
            color: #333;
            transition: border-color 0.2s, box-shadow 0.2s;
            font-family: 'Roboto', sans-serif;
        }

        #input:focus {
            outline: none;
            border-color: #1976d2;
            box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2);
            background: #fff;
        }

        #form button {
            width: 48px;
            height: 48px;
            background: #1976d2;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #form button:hover {
            background: #1565c0;
            transform: scale(1.05);
        }

        #form button .material-icons {
            font-size: 22px;
        }

        /* Modal Base */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal {
            background: #fff;
            padding: 24px;
            border-radius: 8px;
            width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal h3 {
            color: #333;
            margin-bottom: 24px;
            font-weight: 500;
            font-size: 20px;
        }

        .modal input, .modal textarea {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            background: #fff;
            color: #333;
            font-size: 14px;
            margin-bottom: 16px;
            transition: border-color 0.2s, box-shadow 0.2s;
            font-family: 'Roboto', sans-serif;
        }

        .modal textarea {
            resize: vertical;
            min-height: 80px;
        }

        .modal input:focus, .modal textarea:focus {
            outline: none;
            border-color: #1976d2;
            box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2);
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
            margin-top: 8px;
            justify-content: flex-end;
        }

        .modal-buttons button {
            padding: 10px 24px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: 'Roboto', sans-serif;
        }

        .modal-buttons .cancel-btn {
            background: transparent;
            color: #666;
        }

        .modal-buttons .cancel-btn:hover {
            background: #f5f5f5;
        }

        .modal-buttons .save-btn,
        .modal-buttons .create-btn {
            background: #1976d2;
            color: white;
        }

        .modal-buttons .save-btn:hover,
        .modal-buttons .create-btn:hover {
            background: #1565c0;
        }

        .modal-error {
            color: #c62828;
            font-size: 13px;
            margin-bottom: 16px;
            display: none;
            padding: 8px 12px;
            background: #ffebee;
            border-radius: 4px;
        }

        .modal-success {
            color: #2e7d32;
            font-size: 13px;
            margin-bottom: 16px;
            display: none;
            padding: 8px 12px;
            background: #e8f5e9;
            border-radius: 4px;
        }

        /* Profile Modal Specific */
        .profile-modal {
            width: 450px;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid #e0e0e0;
        }

        .profile-avatar-large {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .profile-header-info h4 {
            font-size: 20px;
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
        }

        .profile-header-info p {
            font-size: 14px;
            color: #757575;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 12px;
            font-weight: 500;
            color: #757575;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .form-group input, .form-group textarea, .form-group select {
            margin-bottom: 0;
        }

        .color-picker {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .color-option {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: transform 0.2s, border-color 0.2s;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: #333;
        }

        .status-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            background: #fff;
            color: #333;
            font-size: 14px;
            font-family: 'Roboto', sans-serif;
            cursor: pointer;
        }

        .status-select:focus {
            outline: none;
            border-color: #1976d2;
        }

        .section-divider {
            margin: 24px 0;
            padding-top: 24px;
            border-top: 1px solid #e0e0e0;
        }

        .section-title {
            font-size: 14px;
            font-weight: 500;
            color: #333;
            margin-bottom: 16px;
        }

        /* Tabs */
        .modal-tabs {
            display: flex;
            border-bottom: 1px solid #e0e0e0;
            margin: -24px -24px 24px;
            padding: 0 24px;
        }

        .modal-tab {
            padding: 16px 24px;
            font-size: 14px;
            font-weight: 500;
            color: #757575;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: color 0.2s, border-color 0.2s;
        }

        .modal-tab:hover {
            color: #333;
        }

        .modal-tab.active {
            color: #1976d2;
            border-bottom-color: #1976d2;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* User Profile Modal (viewing other users) */
        .user-profile-modal {
            width: 360px;
        }

        .user-profile-header {
            text-align: center;
            padding-bottom: 20px;
        }

        .user-profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
            font-weight: 500;
            text-transform: uppercase;
            margin: 0 auto 16px;
        }

        .user-profile-name {
            font-size: 22px;
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
        }

        .user-profile-username {
            font-size: 14px;
            color: #757575;
            margin-bottom: 12px;
        }

        .user-profile-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: #f5f5f5;
            border-radius: 16px;
            font-size: 13px;
            color: #333;
        }

        .user-profile-bio {
            padding: 20px 0;
            border-top: 1px solid #e0e0e0;
            margin-top: 20px;
        }

        .user-profile-bio h4 {
            font-size: 12px;
            font-weight: 500;
            color: #757575;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .user-profile-bio p {
            font-size: 14px;
            color: #333;
            line-height: 1.5;
        }

        .user-profile-joined {
            font-size: 12px;
            color: #9e9e9e;
            text-align: center;
            padding-top: 16px;
            border-top: 1px solid #e0e0e0;
        }

        /* Responsive */
        @media (max-width: 1100px) {
            #users-sidebar {
                display: none;
            }
        }

        @media (max-width: 800px) {
            #rooms-sidebar {
                width: 72px;
            }
            
            .sidebar-header h3,
            #rooms-list li .room-info,
            #create-room-btn span,
            #profile-card .profile-info,
            #profile-card .settings-icon {
                display: none;
            }

            #rooms-list li {
                justify-content: center;
                padding: 12px;
            }

            #create-room-btn {
                padding: 12px;
            }

            #profile-card {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Auth Screen -->
    <div id="auth-screen" class="elevation-3">
        <h1>Chatto</h1>
        <p id="auth-subtitle">Sign in to continue</p>
        
        <div id="error-message" class="error-message"></div>

        <form id="login-form" class="auth-form">
            <input type="text" id="login-username" placeholder="Username" required />
            <input type="password" id="login-password" placeholder="Password" required />
            <button type="submit">Sign In</button>
        </form>

        <form id="register-form" class="auth-form" style="display: none;">
            <input type="text" id="register-username" placeholder="Username" minlength="3" maxlength="20" required />
            <input type="password" id="register-password" placeholder="Password" minlength="6" required />
            <input type="password" id="register-confirm" placeholder="Confirm Password" required />
            <button type="submit">Create Account</button>
        </form>

        <p class="auth-toggle">
            <span id="toggle-text">New to Chatto?</span>
            <a id="toggle-auth">Create an account</a>
        </p>
    </div>

    <!-- Chat Screen -->
    <div id="chat-screen">
        <div id="chat-layout">
            <!-- Rooms Sidebar -->
            <div id="rooms-sidebar" class="elevation-1">
                <div class="sidebar-header">
                    <h3>Channels</h3>
                </div>
                <ul id="rooms-list"></ul>
                <button id="create-room-btn">
                    <span class="material-icons">add</span>
                    <span>New Channel</span>
                </button>
                <div id="profile-card">
                    <div class="avatar" id="profile-avatar">U</div>
                    <div class="profile-info">
                        <div class="profile-name" id="profile-display-name">Username</div>
                        <div class="profile-status">
                            <span class="status-dot status-online" id="profile-status-dot"></span>
                            <span id="profile-status-text">Online</span>
                        </div>
                    </div>
                    <span class="material-icons settings-icon">settings</span>
                </div>
            </div>

            <!-- Main Chat -->
            <div id="chat-main" class="elevation-1">
                <div id="chat-header">
                    <div class="room-info">
                        <h2 id="current-room-name">Select a channel</h2>
                        <span id="current-room-desc"></span>
                    </div>
                    <div class="user-info">
                        <span class="material-icons">account_circle</span>
                        <strong id="display-username"></strong>
                    </div>
                </div>
                <ul id="messages">
                    <div id="no-room-selected">
                        <span class="material-icons">forum</span>
                        Select a channel to start chatting
                    </div>
                </ul>
                <form id="form">
                    <input id="input" autocomplete="off" placeholder="Type a message..." />
                    <button type="submit">
                        <span class="material-icons">send</span>
                    </button>
                </form>
            </div>

            <!-- Users Sidebar -->
            <div id="users-sidebar" class="elevation-1">
                <div class="sidebar-header">
                    <div class="online-dot"></div>
                    <h3>Online â€” <span id="user-count">0</span></h3>
                </div>
                <ul id="online-users"></ul>
                <button id="logout-btn">
                    <span class="material-icons">logout</span>
                    Sign Out
                </button>
            </div>
        </div>
    </div>

    <!-- Create Room Modal -->
    <div id="create-room-modal" class="modal-overlay">
        <div class="modal elevation-4">
            <h3>Create Channel</h3>
            <div id="modal-error" class="modal-error"></div>
            <input type="text" id="new-room-name" placeholder="Channel name" maxlength="30" />
            <input type="text" id="new-room-desc" placeholder="Description (optional)" maxlength="100" />
            <div class="modal-buttons">
                <button class="cancel-btn" id="cancel-create-room">Cancel</button>
                <button class="create-btn" id="confirm-create-room">Create</button>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profile-modal" class="modal-overlay">
        <div class="modal profile-modal elevation-4">
            <div class="modal-tabs">
                <div class="modal-tab active" data-tab="profile">Profile</div>
                <div class="modal-tab" data-tab="security">Security</div>
            </div>

            <!-- Profile Tab -->
            <div class="tab-content active" id="tab-profile">
                <div class="profile-header">
                    <div class="profile-avatar-large" id="modal-profile-avatar">U</div>
                    <div class="profile-header-info">
                        <h4 id="modal-profile-username">username</h4>
                        <p>Member since <span id="modal-profile-joined">Jan 2024</span></p>
                    </div>
                </div>

                <div id="profile-error" class="modal-error"></div>
                <div id="profile-success" class="modal-success"></div>

                <div class="form-group">
                    <label>Display Name</label>
                    <input type="text" id="edit-display-name" placeholder="Display Name" maxlength="30" />
                </div>

                <div class="form-group">
                    <label>Bio</label>
                    <textarea id="edit-bio" placeholder="Tell us about yourself..." maxlength="150"></textarea>
                </div>

                <div class="form-group">
                    <label>Avatar Color</label>
                    <div class="color-picker" id="color-picker">
                        <div class="color-option" style="background: #1976d2" data-color="#1976d2"></div>
                        <div class="color-option" style="background: #388e3c" data-color="#388e3c"></div>
                        <div class="color-option" style="background: #d32f2f" data-color="#d32f2f"></div>
                        <div class="color-option" style="background: #7b1fa2" data-color="#7b1fa2"></div>
                        <div class="color-option" style="background: #f57c00" data-color="#f57c00"></div>
                        <div class="color-option" style="background: #0097a7" data-color="#0097a7"></div>
                        <div class="color-option" style="background: #5d4037" data-color="#5d4037"></div>
                        <div class="color-option" style="background: #455a64" data-color="#455a64"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Status</label>
                    <select class="status-select" id="edit-status">
                        <option value="online">ðŸŸ¢ Online</option>
                        <option value="away">ðŸŸ¡ Away</option>
                        <option value="busy">ðŸ”´ Busy</option>
                        <option value="offline">âš« Invisible</option>
                    </select>
                </div>

                <div class="modal-buttons">
                    <button class="cancel-btn" id="cancel-profile">Cancel</button>
                    <button class="save-btn" id="save-profile">Save Changes</button>
                </div>
            </div>

            <!-- Security Tab -->
            <div class="tab-content" id="tab-security">
                <div id="security-error" class="modal-error"></div>
                <div id="security-success" class="modal-success"></div>

                <div class="section-title">Change Password</div>

                <div class="form-group">
                    <label>Current Password</label>
                    <input type="password" id="current-password" placeholder="Enter current password" />
                </div>

                <div class="form-group">
                    <label>New Password</label>
                    <input type="password" id="new-password" placeholder="Enter new password" minlength="6" />
                </div>

                <div class="form-group">
                    <label>Confirm New Password</label>
                    <input type="password" id="confirm-new-password" placeholder="Confirm new password" />
                </div>

                <div class="modal-buttons">
                    <button class="cancel-btn" id="cancel-security">Cancel</button>
                    <button class="save-btn" id="save-password">Update Password</button>
                </div>
            </div>
        </div>
    </div>

    <!-- User Profile Modal (viewing other users) -->
    <div id="user-profile-modal" class="modal-overlay">
        <div class="modal user-profile-modal elevation-4">
            <div class="user-profile-header">
                <div class="user-profile-avatar" id="view-user-avatar">U</div>
                <div class="user-profile-name" id="view-user-displayname">Display Name</div>
                <div class="user-profile-username" id="view-user-username">@username</div>
                <div class="user-profile-status">
                    <span class="status-dot status-online" id="view-user-status-dot"></span>
                    <span id="view-user-status-text">Online</span>
                </div>
            </div>
            <div class="user-profile-bio" id="view-user-bio-section">
                <h4>About</h4>
                <p id="view-user-bio">No bio yet.</p>
            </div>
            <div class="user-profile-joined">
                Joined <span id="view-user-joined">January 2024</span>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        let socket;
        let currentUsername = '';
        let currentRoomId = null;
        let rooms = [];
        let myProfile = {};
        let selectedAvatarColor = '#1976d2';

        // DOM Elements
        const authScreen = document.getElementById('auth-screen');
        const chatScreen = document.getElementById('chat-screen');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const toggleAuth = document.getElementById('toggle-auth');
        const toggleText = document.getElementById('toggle-text');
        const authSubtitle = document.getElementById('auth-subtitle');
        const errorMessage = document.getElementById('error-message');
        const form = document.getElementById('form');
        const input = document.getElementById('input');
        const messages = document.getElementById('messages');
        const onlineUsers = document.getElementById('online-users');
        const userCount = document.getElementById('user-count');
        const displayUsername = document.getElementById('display-username');
        const logoutBtn = document.getElementById('logout-btn');
        const roomsList = document.getElementById('rooms-list');
        const currentRoomName = document.getElementById('current-room-name');
        const currentRoomDesc = document.getElementById('current-room-desc');
        const noRoomSelected = document.getElementById('no-room-selected');
        const createRoomBtn = document.getElementById('create-room-btn');
        const createRoomModal = document.getElementById('create-room-modal');
        const newRoomName = document.getElementById('new-room-name');
        const newRoomDesc = document.getElementById('new-room-desc');
        const cancelCreateRoom = document.getElementById('cancel-create-room');
        const confirmCreateRoom = document.getElementById('confirm-create-room');
        const modalError = document.getElementById('modal-error');

        // Profile elements
        const profileCard = document.getElementById('profile-card');
        const profileModal = document.getElementById('profile-modal');
        const profileAvatar = document.getElementById('profile-avatar');
        const profileDisplayName = document.getElementById('profile-display-name');
        const profileStatusDot = document.getElementById('profile-status-dot');
        const profileStatusText = document.getElementById('profile-status-text');

        // User profile modal elements
        const userProfileModal = document.getElementById('user-profile-modal');

        // Check for existing token on page load
        window.addEventListener('load', async () => {
            const token = localStorage.getItem('token');
            if (token) {
                try {
                    const res = await fetch('/api/verify', {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    if (res.ok) {
                        const data = await res.json();
                        currentUsername = data.username;
                        await loadProfile();
                        connectToChat(token);
                    } else {
                        localStorage.removeItem('token');
                    }
                } catch (err) {
                    localStorage.removeItem('token');
                }
            }
        });

        // Load user profile
        async function loadProfile() {
            try {
                const token = localStorage.getItem('token');
                const res = await fetch('/api/profile', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (res.ok) {
                    myProfile = await res.json();
                    updateProfileUI();
                }
            } catch (err) {
                console.error('Error loading profile:', err);
            }
        }

        function updateProfileUI() {
            const initial = (myProfile.displayName || myProfile.username || 'U').charAt(0).toUpperCase();
            profileAvatar.textContent = initial;
            profileAvatar.style.background = myProfile.avatarColor || '#1976d2';
            profileDisplayName.textContent = myProfile.displayName || myProfile.username;
            
            profileStatusDot.className = 'status-dot status-' + (myProfile.status || 'online');
            const statusLabels = { online: 'Online', away: 'Away', busy: 'Busy', offline: 'Invisible' };
            profileStatusText.textContent = statusLabels[myProfile.status] || 'Online';
        }

        // Toggle between login and register
        toggleAuth.addEventListener('click', () => {
            if (loginForm.style.display !== 'none') {
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
                toggleText.textContent = 'Already have an account?';
                toggleAuth.textContent = 'Sign in';
                authSubtitle.textContent = 'Create your account';
            } else {
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                toggleText.textContent = 'New to Chatto?';
                toggleAuth.textContent = 'Create an account';
                authSubtitle.textContent = 'Sign in to continue';
            }
            hideError();
        });

        // Login
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value;

            try {
                const res = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await res.json();
                if (res.ok) {
                    localStorage.setItem('token', data.token);
                    currentUsername = data.username;
                    await loadProfile();
                    connectToChat(data.token);
                } else {
                    showError(data.error);
                }
            } catch (err) {
                showError('Connection error. Please try again.');
            }
        });

        // Register
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('register-username').value.trim();
            const password = document.getElementById('register-password').value;
            const confirm = document.getElementById('register-confirm').value;

            if (password !== confirm) {
                showError('Passwords do not match');
                return;
            }

            try {
                const res = await fetch('/api/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await res.json();
                if (res.ok) {
                    localStorage.setItem('token', data.token);
                    currentUsername = data.username;
                    await loadProfile();
                    connectToChat(data.token);
                } else {
                    showError(data.error);
                }
            } catch (err) {
                showError('Connection error. Please try again.');
            }
        });

        // Fetch and render rooms
        async function loadRooms() {
            try {
                const res = await fetch('/api/rooms');
                rooms = await res.json();
                renderRooms();
            } catch (err) {
                console.error('Error loading rooms:', err);
            }
        }

        function renderRooms() {
            roomsList.innerHTML = '';
            rooms.forEach(room => {
                const li = document.createElement('li');
                li.dataset.roomId = room._id;
                if (room._id === currentRoomId) {
                    li.classList.add('active');
                }
                li.innerHTML = `
                    <span class="material-icons room-icon">tag</span>
                    <div class="room-info">
                        <div class="room-name">${escapeHtml(room.name)}</div>
                        ${room.description ? `<div class="room-desc">${escapeHtml(room.description)}</div>` : ''}
                    </div>
                `;
                li.addEventListener('click', () => joinRoom(room));
                roomsList.appendChild(li);
            });
        }

        function joinRoom(room) {
            if (currentRoomId === room._id) return;

            currentRoomId = room._id;
            currentRoomName.textContent = '# ' + room.name;
            currentRoomDesc.textContent = room.description || '';
            
            document.querySelectorAll('#rooms-list li').forEach(li => {
                li.classList.toggle('active', li.dataset.roomId === room._id);
            });

            messages.innerHTML = '';
            noRoomSelected.style.display = 'none';
            form.style.display = 'flex';

            socket.emit('join room', room._id);
            input.focus();
        }

        // Connect to chat with token
        function connectToChat(token) {
            authScreen.style.display = 'none';
            chatScreen.style.display = 'block';
            displayUsername.textContent = currentUsername;

            loadRooms();

            socket = io({ auth: { token } });

            socket.on('connect_error', (err) => {
                console.error('Connection error:', err.message);
                logout();
            });

            socket.on('message history', (history) => {
                messages.innerHTML = '';
                history.forEach(data => {
                    appendMessage(data);
                });
                messages.scrollTop = messages.scrollHeight;
            });

            socket.on('chat message', (data) => {
                appendMessage(data);
                messages.scrollTop = messages.scrollHeight;
            });

            socket.on('user joined room', (data) => {
                addSystemMessage(`${data.username} joined the channel`);
                updateUserList(data.users);
            });

            socket.on('user left room', (data) => {
                addSystemMessage(`${data.username} left the channel`);
                updateUserList(data.users);
            });

            socket.on('room created', (room) => {
                rooms.push(room);
                renderRooms();
            });

            socket.on('user profile updated', (data) => {
                // Update user in online list if present
                if (data.username === currentUsername) {
                    myProfile = { ...myProfile, ...data };
                    updateProfileUI();
                }
            });
        }

        function appendMessage(data) {
            const li = document.createElement('li');
            li.className = 'message' + (data.username === currentUsername ? ' own' : '');
            const initial = (data.displayName || data.username).charAt(0).toUpperCase();
            const avatarColor = data.avatarColor || '#1976d2';
            li.innerHTML = `
                <div class="avatar" style="background: ${avatarColor}">${initial}</div>
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-username">${escapeHtml(data.displayName || data.username)}</span>
                        <span class="message-time">${data.timestamp}</span>
                    </div>
                    <div class="message-text">${escapeHtml(data.message)}</div>
                </div>
            `;
            messages.appendChild(li);
        }

        // Send message
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            if (input.value.trim() && socket && currentRoomId) {
                socket.emit('chat message', input.value);
                input.value = '';
            }
        });

        // Create room modal
        createRoomBtn.addEventListener('click', () => {
            createRoomModal.style.display = 'flex';
            newRoomName.value = '';
            newRoomDesc.value = '';
            modalError.style.display = 'none';
            newRoomName.focus();
        });

        cancelCreateRoom.addEventListener('click', () => {
            createRoomModal.style.display = 'none';
        });

        createRoomModal.addEventListener('click', (e) => {
            if (e.target === createRoomModal) {
                createRoomModal.style.display = 'none';
            }
        });

        confirmCreateRoom.addEventListener('click', () => {
            const name = newRoomName.value.trim();
            const description = newRoomDesc.value.trim();

            if (!name) {
                modalError.textContent = 'Channel name is required';
                modalError.style.display = 'block';
                return;
            }

            socket.emit('create room', { name, description }, (response) => {
                if (response.error) {
                    modalError.textContent = response.error;
                    modalError.style.display = 'block';
                } else {
                    createRoomModal.style.display = 'none';
                    joinRoom(response.room);
                }
            });
        });

        // Profile Modal
        profileCard.addEventListener('click', () => {
            openProfileModal();
        });

        function openProfileModal() {
            profileModal.style.display = 'flex';
            
            // Populate form with current values
            document.getElementById('modal-profile-avatar').textContent = (myProfile.displayName || myProfile.username || 'U').charAt(0).toUpperCase();
            document.getElementById('modal-profile-avatar').style.background = myProfile.avatarColor || '#1976d2';
            document.getElementById('modal-profile-username').textContent = '@' + myProfile.username;
            document.getElementById('modal-profile-joined').textContent = new Date(myProfile.createdAt).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            
            document.getElementById('edit-display-name').value = myProfile.displayName || '';
            document.getElementById('edit-bio').value = myProfile.bio || '';
            document.getElementById('edit-status').value = myProfile.status || 'online';
            
            selectedAvatarColor = myProfile.avatarColor || '#1976d2';
            document.querySelectorAll('.color-option').forEach(opt => {
                opt.classList.toggle('selected', opt.dataset.color === selectedAvatarColor);
            });

            // Reset messages
            document.getElementById('profile-error').style.display = 'none';
            document.getElementById('profile-success').style.display = 'none';
            document.getElementById('security-error').style.display = 'none';
            document.getElementById('security-success').style.display = 'none';
            
            // Reset password fields
            document.getElementById('current-password').value = '';
            document.getElementById('new-password').value = '';
            document.getElementById('confirm-new-password').value = '';
        }

        // Profile tabs
        document.querySelectorAll('.modal-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
            });
        });

        // Color picker
        document.querySelectorAll('.color-option').forEach(opt => {
            opt.addEventListener('click', () => {
                document.querySelectorAll('.color-option').forEach(o => o.classList.remove('selected'));
                opt.classList.add('selected');
                selectedAvatarColor = opt.dataset.color;
                document.getElementById('modal-profile-avatar').style.background = selectedAvatarColor;
            });
        });

        // Save profile
        document.getElementById('save-profile').addEventListener('click', async () => {
            const token = localStorage.getItem('token');
            const profileError = document.getElementById('profile-error');
            const profileSuccess = document.getElementById('profile-success');

            try {
                const res = await fetch('/api/profile', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        displayName: document.getElementById('edit-display-name').value.trim(),
                        bio: document.getElementById('edit-bio').value.trim(),
                        avatarColor: selectedAvatarColor,
                        status: document.getElementById('edit-status').value
                    })
                });

                const data = await res.json();
                if (res.ok) {
                    myProfile = data;
                    updateProfileUI();
                    profileSuccess.textContent = 'Profile updated successfully!';
                    profileSuccess.style.display = 'block';
                    profileError.style.display = 'none';
                    setTimeout(() => {
                        profileModal.style.display = 'none';
                    }, 1000);
                } else {
                    profileError.textContent = data.error;
                    profileError.style.display = 'block';
                    profileSuccess.style.display = 'none';
                }
            } catch (err) {
                profileError.textContent = 'Connection error. Please try again.';
                profileError.style.display = 'block';
                profileSuccess.style.display = 'none';
            }
        });

        // Save password
        document.getElementById('save-password').addEventListener('click', async () => {
            const token = localStorage.getItem('token');
            const securityError = document.getElementById('security-error');
            const securitySuccess = document.getElementById('security-success');
            
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-new-password').value;

            if (newPassword !== confirmPassword) {
                securityError.textContent = 'New passwords do not match';
                securityError.style.display = 'block';
                securitySuccess.style.display = 'none';
                return;
            }

            try {
                const res = await fetch('/api/profile/password', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ currentPassword, newPassword })
                });

                const data = await res.json();
                if (res.ok) {
                    securitySuccess.textContent = 'Password updated successfully!';
                    securitySuccess.style.display = 'block';
                    securityError.style.display = 'none';
                    document.getElementById('current-password').value = '';
                    document.getElementById('new-password').value = '';
                    document.getElementById('confirm-new-password').value = '';
                } else {
                    securityError.textContent = data.error;
                    securityError.style.display = 'block';
                    securitySuccess.style.display = 'none';
                }
            } catch (err) {
                securityError.textContent = 'Connection error. Please try again.';
                securityError.style.display = 'block';
                securitySuccess.style.display = 'none';
            }
        });

        // Cancel profile modal
        document.getElementById('cancel-profile').addEventListener('click', () => {
            profileModal.style.display = 'none';
        });

        document.getElementById('cancel-security').addEventListener('click', () => {
            profileModal.style.display = 'none';
        });

        profileModal.addEventListener('click', (e) => {
            if (e.target === profileModal) {
                profileModal.style.display = 'none';
            }
        });

        // View user profile
        async function viewUserProfile(username) {
            try {
                const res = await fetch(`/api/users/${username}`);
                if (res.ok) {
                    const user = await res.json();
                    
                    const initial = (user.displayName || user.username).charAt(0).toUpperCase();
                    document.getElementById('view-user-avatar').textContent = initial;
                    document.getElementById('view-user-avatar').style.background = user.avatarColor || '#1976d2';
                    document.getElementById('view-user-displayname').textContent = user.displayName || user.username;
                    document.getElementById('view-user-username').textContent = '@' + user.username;
                    
                    const statusDot = document.getElementById('view-user-status-dot');
                    statusDot.className = 'status-dot status-' + (user.status || 'online');
                    const statusLabels = { online: 'Online', away: 'Away', busy: 'Busy', offline: 'Offline' };
                    document.getElementById('view-user-status-text').textContent = statusLabels[user.status] || 'Online';
                    
                    document.getElementById('view-user-bio').textContent = user.bio || 'No bio yet.';
                    document.getElementById('view-user-joined').textContent = new Date(user.createdAt).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                    
                    userProfileModal.style.display = 'flex';
                }
            } catch (err) {
                console.error('Error fetching user profile:', err);
            }
        }

        userProfileModal.addEventListener('click', (e) => {
            if (e.target === userProfileModal) {
                userProfileModal.style.display = 'none';
            }
        });

        // Logout
        logoutBtn.addEventListener('click', logout);

        function logout() {
            localStorage.removeItem('token');
            if (socket) {
                socket.disconnect();
            }
            currentUsername = '';
            currentRoomId = null;
            rooms = [];
            myProfile = {};
            messages.innerHTML = `<div id="no-room-selected">
                <span class="material-icons">forum</span>
                Select a channel to start chatting
            </div>`;
            form.style.display = 'none';
            chatScreen.style.display = 'none';
            authScreen.style.display = 'block';
            loginForm.reset();
            registerForm.reset();
        }

        // Helpers
        function showError(msg) {
            errorMessage.textContent = msg;
            errorMessage.style.display = 'block';
        }

        function hideError() {
            errorMessage.style.display = 'none';
        }

        function addSystemMessage(text) {
            const li = document.createElement('li');
            li.className = 'system-message';
            li.textContent = text;
            messages.appendChild(li);
            messages.scrollTop = messages.scrollHeight;
        }

        function updateUserList(users) {
            onlineUsers.innerHTML = '';
            userCount.textContent = users.length;
            users.forEach(user => {
                const li = document.createElement('li');
                const initial = (user.displayName || user.username).charAt(0).toUpperCase();
                const avatarColor = user.avatarColor || '#1976d2';
                const status = user.status || 'online';
                li.innerHTML = `
                    <div class="avatar" style="background: ${avatarColor}">
                        ${initial}
                        <span class="status-dot status-${status}"></span>
                    </div>
                    <span>${escapeHtml(user.displayName || user.username)}</span>
                `;
                li.addEventListener('click', () => {
                    if (user.username !== currentUsername) {
                        viewUserProfile(user.username);
                    }
                });
                onlineUsers.appendChild(li);
            });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
